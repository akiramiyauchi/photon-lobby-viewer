<script>
    function formatTimestamp(timestamp) {
        if (!timestamp) return "Unknown time";
    
        // Firestore Timestamp 型の処理
        if (timestamp._seconds) {
            return new Date(timestamp._seconds * 1000).toLocaleString();
        }
    
        // 文字列として送られてきた場合
        const date = new Date(timestamp);
        return isNaN(date.getTime()) ? "Invalid Date" : date.toLocaleString();
    }


    async function fetchRoomUpdates() {
        try {
            const response = await fetch('/.netlify/functions/getRoomUpdates');
    
            if (!response.ok) {
                throw new Error(`Server error: ${response.status}`);
            }
    
            const data = await response.json();
            console.log("Received Data:", data); // デバッグ用
    
            const playerList = document.getElementById('playerList');
            const errorMessage = document.getElementById('errorMessage');
    
            // リストをクリア
            playerList.innerHTML = '';
            errorMessage.textContent = '';
    
            if (data.length === 0) {
                playerList.innerHTML = '<li>現在、ロビーにプレイヤーはいません。</li>';
                return;
            }
    
            data.forEach(item => {
                const listItem = document.createElement('li');
                listItem.textContent = `Player ${item.player} ${item.status} at ${formatTimestamp(item.timestamp)}`;
                playerList.appendChild(listItem);
            });
        } catch (error) {
            console.error("Error fetching room updates:", error);
            document.getElementById('errorMessage').textContent = "データの取得に失敗しました。";
        }
    }


    setInterval(fetchRoomUpdates, 3000);
</script>
