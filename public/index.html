<table>
    <thead>
        <tr>
            <th>Display Name</th>
            <th>Level</th>  <!-- 🔹 レベルの列を追加 -->
            <th>Status</th>
        </tr>
    </thead>
    <tbody id="playerTableBody">
    </tbody>
</table>

<script>
    async function fetchRoomUpdates() {
        try {
            const response = await fetch('/.netlify/functions/getRoomUpdates');

            if (!response.ok) {
                throw new Error(`Server error: ${response.status}`);
            }

            const data = await response.json();
            console.log("📌 取得したデータ:", data);

            const playerTableBody = document.getElementById('playerTableBody');
            playerTableBody.innerHTML = '';

            if (!data.players || Object.keys(data.players).length === 0) {
                playerTableBody.innerHTML = '<tr><td colspan="3">No players in the lobby.</td></tr>';
                return;
            }

            Object.keys(data.players).forEach(oculusId => {
                const playerData = data.players[oculusId];

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${playerData.displayName}</td>
                    <td>${playerData.level ?? "N/A"}</td>  <!-- 🔹 レベルを表示 -->
                    <td>${playerData.status}</td>
                `;
                playerTableBody.appendChild(row);
            });
        } catch (error) {
            console.error("❌ データの取得に失敗しました:", error);
            document.getElementById('errorMessage').textContent = "Failed to fetch data.";
        }
    }

    setInterval(fetchRoomUpdates, 3000);
</script>
