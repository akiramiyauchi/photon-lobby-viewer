<table>
    <thead>
        <tr>
            <th>Display Name</th>
            <th>Level</th>  <!-- ğŸ”¹ ãƒ¬ãƒ™ãƒ«ã®åˆ—ã‚’è¿½åŠ  -->
            <th>Status</th>
        </tr>
    </thead>
    <tbody id="playerTableBody">
    </tbody>
</table>

<script>
    async function fetchRoomUpdates() {
        try {
            const response = await fetch('/.netlify/functions/getRoomUpdates');

            if (!response.ok) {
                throw new Error(`Server error: ${response.status}`);
            }

            const data = await response.json();
            console.log("ğŸ“Œ å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:", data);

            const playerTableBody = document.getElementById('playerTableBody');
            playerTableBody.innerHTML = '';

            if (!data.players || Object.keys(data.players).length === 0) {
                playerTableBody.innerHTML = '<tr><td colspan="3">No players in the lobby.</td></tr>';
                return;
            }

            Object.keys(data.players).forEach(oculusId => {
                const playerData = data.players[oculusId];

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${playerData.displayName}</td>
                    <td>${playerData.level ?? "N/A"}</td>  <!-- ğŸ”¹ ãƒ¬ãƒ™ãƒ«ã‚’è¡¨ç¤º -->
                    <td>${playerData.status}</td>
                `;
                playerTableBody.appendChild(row);
            });
        } catch (error) {
            console.error("âŒ ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
            document.getElementById('errorMessage').textContent = "Failed to fetch data.";
        }
    }

    setInterval(fetchRoomUpdates, 3000);
</script>
